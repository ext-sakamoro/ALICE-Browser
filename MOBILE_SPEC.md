# ALICE Browser Mobile — 仕様書

## 1. プロジェクト概要

ALICE Browser Mobileは、広告・トラッカーを自動ブロックする軽量モバイルブラウザである。
Rust製の高速エンジンをベースに、**「広告なし・軽量・サクサク」**を最優先で提供する。

3D/空間UIは搭載しない。スマホユーザーが求める「快適な2Dブラウジング」に徹する。

### ポジショニング

```
既存ブラウザとの比較:

Chrome      → 高機能だが広告まみれ、Google依存
Safari      → Apple専用、カスタマイズ性低
Brave       → 広告ブロック+暗号通貨（BAT）、やや重い
Firefox     → オープンだがモバイルは存在感薄い

ALICE Browser Mobile:
  → 広告完全ブロック
  → Rust製で軽量・高速
  → オープンソース (MIT / Apache 2.0)
  → ALICEエコシステムへの入口
```

### 戦略的位置づけ

```
ALICE Browser Mobile (無料・広告なし)
  → ユーザーの手元に「ALICE」を届ける
  → ALICEエコシステムの認知拡大
  → デスクトップ版 (3D/OZ Mode) への導線
  → 将来的にALICE Core連携の入口
```

---

## 2. ターゲットプラットフォーム

| プラットフォーム | 対応方針 |
|----------------|---------|
| Android | 最優先。egui + winiтのAndroid対応を活用 |
| iOS | 第二優先。egui + winit の iOS対応を活用 |

### ビルド構成

```
デスクトップ版:  cargo build --features sdf-render
モバイル版:      cargo build (sdf-render フィーチャー除外)
```

既存コードは `#[cfg(feature = "sdf-render")]` で3D関連を全てゲートしているため、
フィーチャーフラグを外すだけでモバイル用軽量ビルドが生成される。

---

## 3. 機能仕様

### 3.1 コア機能

| 機能 | 説明 | 優先度 |
|------|------|--------|
| Webページ表示 | DOM解析 → Layout → 2D Flat描画 | 必須 |
| 広告ブロック | Classification::Advertisement を非表示 | 必須 |
| トラッカーブロック | Classification::Tracker を除去 | 必須 |
| 装飾ノイズ除去 | Classification::Decoration を簡素化 | 必須 |
| URL入力・ナビゲーション | アドレスバー、戻る/進む、履歴 | 必須 |
| リンク遷移 | ページ内リンク、外部リンク、リダイレクト対応 | 必須 |
| HTTPS対応 | TLS通信、証明書検証 | 必須 |

### 3.2 ユーザー体験機能

| 機能 | 説明 | 優先度 |
|------|------|--------|
| リーダーモード | 本文のみ抽出・整形表示 | 高 |
| ダークモード | 既存の dark_mode トグルを活用 | 高 |
| ページ内検索 | 既存の search フィーチャーを活用 | 高 |
| ブックマーク | ローカル保存、エクスポート/インポート | 中 |
| タブ管理 | 複数ページの切り替え | 中 |
| プライベートモード | 履歴・Cookie を残さないモード | 中 |

### 3.3 パフォーマンス機能

| 機能 | 説明 | 優先度 |
|------|------|--------|
| 画像遅延読み込み | スクロール位置に応じた画像ロード | 高 |
| キャッシュ | smart-cache フィーチャーを活用 | 高 |
| データ節約モード | 画像品質の自動調整、不要リソース非取得 | 中 |

### 3.4 搭載しない機能

| 機能 | 理由 |
|------|------|
| 3D Spatial モード | モバイルに不要。デスクトップ/VR専用 |
| OZ Rotunda モード | 同上 |
| SDF描画 | 同上 |
| GPU レンダリング (wgpu) | モバイル版はCPU描画で十分 |
| 暗号通貨・報酬系 | 複雑さを排除。シンプルさ最優先 |
| アカウント・ログイン | ローカルファーストの設計 |

---

## 4. 広告・トラッカーブロック仕様

### 4.1 既存基盤

ALICE Browserは既にDOM分類エンジンを搭載している:

```rust
// dom/classifier.rs
enum Classification {
    Content,          // 本文コンテンツ → 表示
    Navigation,       // ナビゲーション → 表示
    Advertisement,    // 広告 → ブロック
    Tracker,          // トラッカー → ブロック
    Decoration,       // 装飾 → 簡素化/除去
}
```

### 4.2 ブロック方式

```
レイヤー1: DNS/URLレベル
  → 既知の広告ドメイン (doubleclick.net, etc.) をリクエスト前にブロック
  → EasyList / EasyPrivacy 互換のフィルタリスト対応

レイヤー2: DOMレベル
  → ページ取得後、Classification::Advertisement / Tracker ノードを除去
  → 既存の DOM分類エンジンをそのまま活用

レイヤー3: CSSレベル
  → 広告用の固定位置オーバーレイ、ポップアップを非表示
  → "cookie同意" バナーの自動非表示
```

### 4.3 ブロック統計

ユーザーに表示する統計情報:

- ブロックした広告数（ページ単位 / 累計）
- ブロックしたトラッカー数
- 節約した推定データ量
- 節約した推定読み込み時間

---

## 5. 技術スタック

### 5.1 言語・フレームワーク

| コンポーネント | 技術 | 理由 |
|--------------|------|------|
| 言語 | Rust | メモリ安全性、速度、クロスプラットフォーム |
| UI | egui (eframe) | 軽量、Rust純正、モバイル対応 |
| ウィンドウ | winit | Android/iOS ネイティブウィンドウ |
| ネットワーク | reqwest / ureq | HTTP/HTTPS通信 |
| HTML解析 | 独自パーサー (dom/parser.rs) | 軽量・カスタマイズ可能 |
| CSS解析 | 独自パーサー | 必要最低限のCSS対応 |
| レイアウト | 独自エンジン (render/layout.rs) | 2D Flatに特化 |
| キャッシュ | smart-cache フィーチャー | ディスクキャッシュ |

### 5.2 ビルド構成

```toml
# Cargo.toml

[features]
default = []                    # モバイル: 2D のみ
sdf-render = ["alice-sdf"]      # デスクトップ: 3D/OZ 有効
smart-cache = []                # キャッシュ (両方で使用)
search = []                     # ページ内検索 (両方で使用)
mobile = []                     # モバイル専用機能
```

### 5.3 モバイルビルド手順

```bash
# Android
cargo ndk -t arm64-v8a -o ./jniLibs build --release --features "smart-cache,search,mobile"

# iOS
cargo lipo --release --features "smart-cache,search,mobile"
```

### 5.4 アーキテクチャ

```
┌─────────────────────────────────┐
│        ALICE Browser Mobile      │
├─────────────────────────────────┤
│  UI Layer (egui)                 │
│  ├─ アドレスバー                  │
│  ├─ タブバー                     │
│  ├─ 2D Flat レンダラー           │
│  └─ ブロック統計表示              │
├─────────────────────────────────┤
│  Content Layer                   │
│  ├─ DOM Parser                   │
│  ├─ DOM Classifier (広告/トラッカー判定) │
│  ├─ CSS Parser                   │
│  └─ Layout Engine                │
├─────────────────────────────────┤
│  Network Layer                   │
│  ├─ HTTP/HTTPS Fetcher           │
│  ├─ DNS-Level Ad Block           │
│  ├─ Filter List Manager          │
│  ├─ Image Loader (lazy)          │
│  └─ Cache Manager                │
├─────────────────────────────────┤
│  Platform Layer                  │
│  ├─ winit (ウィンドウ管理)        │
│  ├─ Android JNI Bridge           │
│  └─ iOS FFI Bridge               │
└─────────────────────────────────┘
```

---

## 6. UI デザイン方針

### 6.1 原則

- **ミニマル**: 余計なUIを排除。コンテンツ領域を最大化
- **高速応答**: タップから表示まで体感200ms以内
- **片手操作**: 主要操作は画面下部に集約

### 6.2 画面構成

```
┌─────────────────────────┐
│ [ブロック数: 12] [🔒]    │  ← ステータスバー（最小限）
├─────────────────────────┤
│                          │
│                          │
│     Webページコンテンツ    │  ← コンテンツ領域（最大化）
│                          │
│                          │
│                          │
├─────────────────────────┤
│ [←] [→] [URL...   ] [⋮] │  ← 操作バー（画面下部、片手操作）
└─────────────────────────┘
```

### 6.3 操作

| 操作 | アクション |
|------|----------|
| 下スワイプ | ステータスバー表示 |
| 上スワイプ | 操作バー非表示（フルスクリーン） |
| 長押し | リンクプレビュー |
| 左端からスワイプ | 戻る |
| 右端からスワイプ | 進む |
| ダブルタップ | ズーム |

---

## 7. ライセンス戦略

### 7.1 ALICE Browser (モバイル & デスクトップ)

```
ライセンス: MIT OR Apache-2.0 (デュアルライセンス)

理由:
  - 企業が採用する際の法務ハードルをゼロにする
  - fork・改変・商用組み込みを無制限に許可
  - ユーザー数の最大化が最優先目標
```

### 7.2 ALICE Core (将来)

```
ライセンス: 商用ライセンス or AGPL-3.0

理由:
  - ALICE Core (Swarm, Specialist, Level5等) が収益源
  - ブラウザで集めたユーザーを ALICE Core の顧客に変換
  - OSSとして公開する場合は AGPL で囲い込み
```

### 7.3 収益モデル

```
ALICE Browser (無料・OSS)
  → ユーザー獲得 (広告ブロックで差別化)
  → ALICEブランドの認知拡大
  → ALICE Core への導線

ALICE Core (商用)
  → Enterprise向けライセンス
  → API利用課金
  → カスタムSpecialist開発
  → サポート契約
```

---

## 8. 配布戦略

### 8.1 ストア公開

| ストア | 方針 |
|--------|------|
| Google Play | 公開（広告ブロック系は審査厳しいため説明に注意） |
| Apple App Store | 公開（Safari WebKit制約あり、要検討） |
| F-Droid | 公開（OSSユーザー向け、審査なし） |
| GitHub Releases | APK / IPA 直接配布 |
| 公式サイト | ダウンロードリンク |

### 8.2 Apple App Store の制約

iOSではサードパーティブラウザはWebKitエンジンの使用が義務付けられている。
EU圏ではDMA (Digital Markets Act) により2024年からWebKit制約が緩和されたが、
日本を含む他地域では依然として制約あり。

対応方針:
- iOS版はWebKitベースのラッパーとして実装する選択肢もある
- その場合でも広告ブロック(Content Blocker API)とUIは独自
- EU向けには独自エンジン版を配布可能

### 8.3 Google Play の広告ブロッカー対策

Google Playは他アプリの広告をブロックするアプリを禁止しているが、
ブラウザ内蔵の広告ブロックは許可されている (Brave, Firefox Focus等の前例あり)。

- 「ブラウザ」カテゴリで公開
- 広告ブロックは「プライバシー保護機能」として説明
- 他アプリへの干渉はしない設計

---

## 9. ロードマップ

### Phase 1: 基盤整備

- [ ] ライセンスファイル (LICENSE-MIT, LICENSE-APACHE) 追加
- [ ] モバイル用フィーチャーフラグ (`mobile`) 追加
- [ ] 2D Flatモードの最適化（タッチ操作対応）
- [ ] 広告フィルタリスト (EasyList) のパーサー実装
- [ ] DNS レベルブロックの実装

### Phase 2: Android版

- [ ] Android ビルド環境構築 (cargo-ndk)
- [ ] winit + egui の Android 動作確認
- [ ] タッチ操作・ジェスチャー実装
- [ ] モバイルUI (下部操作バー、フルスクリーン)
- [ ] APK ビルド・テスト

### Phase 3: 公開

- [ ] GitHub リポジトリ公開 (MIT / Apache 2.0)
- [ ] F-Droid 公開
- [ ] Google Play 公開
- [ ] 公式サイト・ランディングページ作成

### Phase 4: iOS版

- [ ] iOS ビルド環境構築 (cargo-lipo)
- [ ] WebKit wrapper or 独自エンジンの方針決定
- [ ] App Store 公開

### Phase 5: ALICE連携

- [ ] ALICE Swarm Manager との接続インターフェース
- [ ] ページ分析結果の表示UI (セキュリティ警告等)
- [ ] デスクトップ版 (3D/OZ) への導線UI

---

## 10. 競合比較

| 項目 | Chrome | Safari | Brave | Firefox Focus | ALICE Mobile |
|------|--------|--------|-------|---------------|-------------|
| 広告ブロック | ✗ | ✗ | ✅ | ✅ | ✅ |
| トラッカーブロック | △ | △ | ✅ | ✅ | ✅ |
| オープンソース | △ (Chromium) | ✗ | ✅ | ✅ | ✅ |
| ライセンス | BSD-like | 非公開 | MPL 2.0 | MPL 2.0 | MIT/Apache 2.0 |
| 軽量性 | ✗ (重い) | ○ | ○ | ✅ | ✅ (Rust製) |
| AI連携 | Gemini | Apple AI | ✗ | ✗ | ALICE Core |
| 空間UI (デスクトップ) | ✗ | Safari空間 | ✗ | ✗ | OZ Rotunda |
| 暗号通貨 | ✗ | ✗ | BAT | ✗ | ✗ (不要) |
| 企業組み込み | 困難 | 不可 | 可能 | 可能 | 最も容易 |

### ALICE Mobile の差別化ポイント

1. **MIT/Apache 2.0** — 企業が最も採用しやすいライセンス
2. **Rust製** — メモリ安全・高速・省電力
3. **ALICEエコシステム** — 唯一のAI統合ブラウザ
4. **シンプル** — 暗号通貨もアカウントも不要、ブラウザとしての本質に集中

---

## 付録: 広告業界への影響について

広告ブロックブラウザの普及は広告収益モデル企業（Google等）に影響を与えるが、
これは市場原理に基づくユーザー選択の結果である。

- ユーザーにはプライバシーとUXを選択する権利がある
- 広告モデルに依存しない収益構造 (ALICE Core商用ライセンス) を採用
- 「広告を壊す」のではなく「ユーザーが選べる世界を作る」
